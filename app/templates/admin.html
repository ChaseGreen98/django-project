{% extends "root.html" %}

{% block content %}
<div class="nav">
    <a href="{% url 'landing' %}">
        <button class="nav-button">üè† Back to Landing</button>
    </a>
</div>

<div class="admin-container">

    <!-- =======================
         USERS SECTION (Left)
    ======================= -->
    <div class="admin-section">
        <div class="window admin-window">
            <div class="window-titlebar">Users</div>
            <div class="window-content">

                <!-- Users Search -->
                <form method="get" class="search-form">
                    <input type="text" name="user_q" placeholder="Search users..." value="{{ user_query }}">
                    <input type="hidden" name="chat_q" value="{{ chat_query }}">
                    <button type="submit">Search</button>
                </form>

                <div class="user-list">
                    {% for person in user_page_obj %}
                        <div class="user-card">
                            <p>{{ person.username }}</p>
                            {% if request.user.is_staff %}
                            <form method="post" action="{% url 'admin-delete' person.pk %}">
                                {% csrf_token %}
                                <button type="submit" onclick="return confirm('Ban this user?')">Ban User</button>
                            </form>
                            {% endif %}
                        </div>
                    {% empty %}
                        <p>No users found.</p>
                    {% endfor %}
                </div>

                <!-- Pagination -->
                <div class="pagination">
                    {% if user_page_obj.has_previous %}
                        <a href="?user_page={{ user_page_obj.previous_page_number }}&chat_page={{ chat_page_obj.number }}&user_q={{ user_query }}&chat_q={{ chat_query }}">
                            ‚Üê Previous
                        </a>
                    {% endif %}
                    <span>Page {{ user_page_obj.number }} of {{ user_page_obj.paginator.num_pages }}</span>
                    {% if user_page_obj.has_next %}
                        <a href="?user_page={{ user_page_obj.next_page_number }}&chat_page={{ chat_page_obj.number }}&user_q={{ user_query }}&chat_q={{ chat_query }}">
                            Next ‚Üí
                        </a>
                    {% endif %}
                </div>

            </div>
        </div>
    </div>

    <!-- =======================
         CHAT ROOMS SECTION (Right)
    ======================= -->
    <div class="admin-section">
        <div class="window admin-window">
            <div class="window-titlebar">Chat Rooms</div>
            <div class="window-content">

                <!-- Chat Rooms Search -->
                <form method="get" class="search-form">
                    <input type="text" name="chat_q" placeholder="Search chat rooms..." value="{{ chat_query }}">
                    <input type="hidden" name="user_q" value="{{ user_query }}">
                    <button type="submit">Search</button>
                </form>

                <div class="chat-room-admin-list">
                    {% for room in chat_page_obj %}
                        <div class="user-card">
                            <p>{{ room.subject }}</p>
                            <small>{{ room.participants.count }} participants ¬∑ {{ room.messages.count }} messages</small>
                            {% if request.user.is_staff %}
                            <form method="post" action="{% url 'admin-delete-chat' room.pk %}">
                                {% csrf_token %}
                                <button type="submit" onclick="return confirm('Delete this chat room and all messages?')">Delete Room</button>
                            </form>
                            {% endif %}
                        </div>
                    {% empty %}
                        <p>No chat rooms found.</p>
                    {% endfor %}
                </div>

                <!-- Pagination -->
                <div class="pagination">
                    {% if chat_page_obj.has_previous %}
                        <a href="?chat_page={{ chat_page_obj.previous_page_number }}&user_page={{ user_page_obj.number }}&user_q={{ user_query }}&chat_q={{ chat_query }}">
                            ‚Üê Previous
                        </a>
                    {% endif %}
                    <span>Page {{ chat_page_obj.number }} of {{ chat_page_obj.paginator.num_pages }}</span>
                    {% if chat_page_obj.has_next %}
                        <a href="?chat_page={{ chat_page_obj.next_page_number }}&user_page={{ user_page_obj.number }}&user_q={{ user_query }}&chat_q={{ chat_query }}">
                            Next ‚Üí
                        </a>
                    {% endif %}
                </div>

            </div>
        </div>
    </div>

</div>
{% endblock %}
